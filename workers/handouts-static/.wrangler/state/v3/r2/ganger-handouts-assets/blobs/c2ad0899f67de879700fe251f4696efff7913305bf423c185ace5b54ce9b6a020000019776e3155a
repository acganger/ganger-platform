(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[343],{8822:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/generate",function(){return a(31)}])},31:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var s=a(1549),n=a(4194),i=a(8368),r=a(8848),l=a(3960),c=a(2226),o=a.n(c);function d(e){let{onScanned:t,onCancel:a}=e,i=(0,n.useRef)(null),[l,c]=(0,n.useState)(!1),[d,m]=(0,n.useState)(null);(0,n.useEffect)(()=>((async()=>{try{if(!i.current)return;c(!0),m(null),o().init({inputStream:{name:"Live",type:"LiveStream",target:i.current,constraints:{width:480,height:320,facingMode:"environment"}},decoder:{readers:["code_128_reader","ean_reader","ean_8_reader","code_39_reader","code_39_vin_reader","codabar_reader","upc_reader","upc_e_reader","i2of5_reader","2of5_reader","code_93_reader"]},locate:!0},e=>{if(e){m("Failed to initialize camera. Please check permissions."),c(!1);return}o().start()}),o().onDetected(e=>{let a=e.codeResult.code;a&&(o().stop(),c(!1),t(a))})}catch(e){m("Camera access denied. Please allow camera permissions and try again."),c(!1)}})(),()=>{o().stop(),c(!1)}),[t]);let h=()=>{o().stop(),c(!1),a()};return d?(0,s.jsxs)("div",{className:"text-center space-y-4 p-6",children:[(0,s.jsx)("div",{className:"text-red-600 mb-4",children:d}),(0,s.jsx)(r.zx,{onClick:h,variant:"outline",children:"Cancel"})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"text-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Scan Patient QR Code"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Position the QR code within the camera view"})]}),(0,s.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden camera-overlay",children:[(0,s.jsx)("div",{ref:i,className:"w-full h-80"}),l&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"absolute inset-0 border-2 border-handouts-primary rounded-lg"}),(0,s.jsx)("div",{className:"scan-line"}),(0,s.jsx)("div",{className:"absolute top-4 left-4 w-6 h-6 border-l-2 border-t-2 border-handouts-primary"}),(0,s.jsx)("div",{className:"absolute top-4 right-4 w-6 h-6 border-r-2 border-t-2 border-handouts-primary"}),(0,s.jsx)("div",{className:"absolute bottom-4 left-4 w-6 h-6 border-l-2 border-b-2 border-handouts-primary"}),(0,s.jsx)("div",{className:"absolute bottom-4 right-4 w-6 h-6 border-r-2 border-b-2 border-handouts-primary"})]}),!l&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50",children:(0,s.jsxs)("div",{className:"text-white text-center",children:[(0,s.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-white border-t-transparent rounded-full mx-auto mb-2"}),(0,s.jsx)("p",{children:"Initializing camera..."})]})})]}),(0,s.jsxs)("div",{className:"text-center space-y-2",children:[(0,s.jsx)(r.zx,{onClick:h,variant:"outline",className:"w-full",children:"Cancel Scanning"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Make sure the QR code is well-lit and clearly visible"})]})]})}var m=a(8407);let h={education:"handouts-education",treatment:"handouts-treatment",medication:"handouts-medication",pre_procedure:"handouts-procedure",post_procedure:"handouts-procedure"},p={education:"Patient Education",treatment:"Treatment Plans",medication:"Medication Information",pre_procedure:"Pre-Procedure",post_procedure:"Post-Procedure"};function u(e){let{onSelectionChange:t,selectedTemplates:a}=e,{state:i,loadTemplates:l}=(0,m.F)(),[c,o]=(0,n.useState)(""),[d,u]=(0,n.useState)("all");(0,n.useEffect)(()=>{l()},[l]);let x=i.templates.filter(e=>{let t=e.name.toLowerCase().includes(c.toLowerCase())||e.description.toLowerCase().includes(c.toLowerCase()),a="all"===d||e.category===d;return t&&a}),g=Array.from(new Set(i.templates.map(e=>e.category))),y=e=>{t(a.includes(e)?a.filter(t=>t!==e):[...a,e])},f=e=>(0,s.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat({simple:"bg-green-100 text-green-800",moderate:"bg-yellow-100 text-yellow-800",complex:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800"),children:e});return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(r.Zb,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Select Handout Templates"}),(0,s.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,s.jsx)(r.II,{placeholder:"Search templates...",value:c,onChange:e=>o(e.target.value),className:"flex-1"}),(0,s.jsxs)("select",{value:d,onChange:e=>u(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-handouts-primary focus:border-transparent",children:[(0,s.jsx)("option",{value:"all",children:"All Categories"}),g.map(e=>(0,s.jsx)("option",{value:e,children:p[e]||e},e))]})]}),a.length>0&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-handouts-primary/10 border border-handouts-primary/20 rounded-md",children:(0,s.jsxs)("p",{className:"text-sm text-handouts-primary font-medium",children:[a.length," template",1!==a.length?"s":""," selected"]})}),(0,s.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:x.map(e=>(0,s.jsx)(r.Zb,{className:"p-4 cursor-pointer transition-all hover:shadow-md ".concat(a.includes(e.id)?"ring-2 ring-handouts-primary border-handouts-primary":"border-gray-200"),onClick:()=>y(e.id),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(r.XZ,{checked:a.includes(e.id),onChange:()=>y(e.id),className:"mt-1"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900 truncate",children:e.name}),f(e.complexity)]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:e.description}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,s.jsx)("span",{className:"px-2 py-1 rounded-full bg-".concat(h[e.category],"/10 text-").concat(h[e.category]),children:p[e.category]||e.category}),(0,s.jsxs)("span",{children:["~",e.estimatedTime," min"]})]}),e.digitalDeliveryEnabled&&(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-1 text-xs text-green-600",children:[(0,s.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Digital delivery available"]})]})]})},e.id))}),0===x.length&&(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:c||"all"!==d?"No templates found matching your criteria.":"No templates available."})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("div",{className:"text-sm text-gray-600",children:a.length>0&&(0,s.jsxs)("span",{children:["Estimated generation time: ",i.templates.filter(e=>a.includes(e.id)).reduce((e,t)=>e+t.estimatedTime,0)," minutes"]})}),(0,s.jsxs)("div",{className:"space-x-2",children:[a.length>0&&(0,s.jsx)(r.zx,{onClick:()=>t([]),variant:"outline",size:"sm",children:"Clear Selection"}),(0,s.jsxs)(r.zx,{onClick:()=>t(a),disabled:0===a.length,variant:"primary",children:["Continue with ",a.length," Template",1!==a.length?"s":""]})]})]})]})}function x(e){let{patient:t}=e;return(0,s.jsx)(r.Zb,{className:"p-4 bg-blue-50 border-blue-200",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,s.jsxs)("span",{className:"text-blue-600 font-semibold text-lg",children:[t.firstName.charAt(0),t.lastName.charAt(0)]})})}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"font-semibold text-gray-900",children:[t.firstName," ",t.lastName]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["MRN: ",t.mrn]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Date of Birth"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:(e=>{if(!e)return"Not provided";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch(t){return e}})(t.dateOfBirth)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[t.email&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Email"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 truncate",children:t.email})]}),t.phone&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Phone"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:(e=>{if(!e)return"Not provided";let t=e.replace(/\D/g,"");return 10===t.length?"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6)):11===t.length&&t.startsWith("1")?"+1 (".concat(t.slice(1,4),") ").concat(t.slice(4,7),"-").concat(t.slice(7)):e})(t.phone)})]})]})]})}),(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full",title:"Patient verified"})})]})})}class g{async sendHandoutDelivery(e,t,a,s){try{let n=await fetch("/api/handouts/communication/send-delivery",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:e,handout_title:t,handout_url:a,provider_name:s,clinic_name:"Ganger Dermatology"})});if(!n.ok)throw Error("Communication service request failed");let i=await n.json();return{success:i.success,error:i.error}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async recordPatientConsent(e,t,a,s,n,i){try{if(!(await fetch("/api/handouts/communication/consent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:e,consentType:t,consented:a,method:"digital",staffId:s,ipAddress:n,userAgent:i})})).ok)throw Error("Failed to record consent");return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async updatePatientContact(e,t,a,s){try{if(!(await fetch("/api/handouts/communication/contact",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:e,phoneNumber:t,email:a,preferredMethod:s})})).ok)throw Error("Failed to update contact");return{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async hasPatientConsent(e,t){try{let a=await fetch("/api/handouts/communication/consent/".concat(e,"?type=").concat(t));if(!a.ok)return!1;return(await a.json()).hasConsent||!1}catch(e){return!1}}async getPatientCommunicationHistory(e,t){try{let a="/api/handouts/communication/history/".concat(e).concat(t?"?limit=".concat(t):""),s=await fetch(a);if(!s.ok)return[];return await s.json()}catch(e){return[]}}async healthCheck(){try{let e=await fetch("/api/handouts/communication/health");if(!e.ok)return{sms_service:!1,database:!1,overall:!1};return await e.json()}catch(e){return{sms_service:!1,database:!1,overall:!1}}}constructor(){}}let y=new g;function f(e){let{patient:t,options:a,onChange:i,onGenerate:l}=e,[c,o]=(0,n.useState)(!1),[d,m]=(0,n.useState)({email:(null==t?void 0:t.email)||"",phone:(null==t?void 0:t.phone)||""}),[h,p]=(0,n.useState)(!1),[u,x]=(0,n.useState)({sms:!1,email:!1}),[g,f]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(null==t?void 0:t.id)&&v()},[null==t?void 0:t.id]);let v=async()=>{if(null==t?void 0:t.id)try{let[e,s]=await Promise.all([y.hasPatientConsent(t.id,"sms"),y.hasPatientConsent(t.id,"email")]);x({sms:e,email:s}),(a.sms&&e||a.email&&s)&&p(!0)}catch(e){}},j=(e,t)=>{i({...a,[e]:t})},N=async()=>{if(null==t?void 0:t.id){f(!0);try{(await y.updatePatientContact(t.id,d.phone,d.email,a.sms&&a.email?"both":a.sms?"sms":"email")).success&&(o(!1),await v())}catch(e){}finally{f(!1)}}},b=a.print||a.email&&d.email&&(h||u.email)||a.sms&&d.phone&&(h||u.sms),w=a.email||a.sms,k=w&&!(a.sms&&u.sms||a.email&&u.email),S=async()=>{if(k&&h&&(null==t?void 0:t.id)){f(!0);try{let e=a.sms&&a.email?"both":a.sms?"sms":"email";await y.recordPatientConsent(t.id,e,!0,void 0,void 0,navigator.userAgent)}catch(e){}finally{f(!1)}}l({smsEnabled:a.sms&&(h||u.sms),emailEnabled:a.email&&(h||u.email),consentRecorded:!k||h})};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(r.Zb,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Delivery Options"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg",children:[(0,s.jsx)(r.XZ,{checked:a.print,onChange:e=>j("print",e.target.checked)}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),(0,s.jsx)("h4",{className:"font-medium",children:"Print for Patient Pickup"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Print handouts for immediate patient pickup at checkout"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg",children:[(0,s.jsx)(r.XZ,{checked:a.email,onChange:e=>j("email",e.target.checked),disabled:!d.email}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),(0,s.jsx)("h4",{className:"font-medium",children:"Email PDF Attachments"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Send handouts as PDF attachments to patient email"}),!d.email&&(0,s.jsx)("p",{className:"text-sm text-red-600 mt-1",children:"Email address required"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg",children:[(0,s.jsx)(r.XZ,{checked:a.sms,onChange:e=>j("sms",e.target.checked),disabled:!d.phone}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,s.jsx)("h4",{className:"font-medium",children:"SMS Download Link"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Send secure download link via text message"}),!d.phone&&(0,s.jsx)("p",{className:"text-sm text-red-600 mt-1",children:"Phone number required"})]})]})]})]}),(0,s.jsxs)(r.Zb,{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Contact Information"}),!c&&(0,s.jsx)(r.zx,{onClick:()=>o(!0),variant:"outline",size:"sm",children:"Edit"})]}),c?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,s.jsx)(r.II,{type:"email",value:d.email,onChange:e=>m({...d,email:e.target.value}),placeholder:"patient@example.com"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),(0,s.jsx)(r.II,{type:"tel",value:d.phone,onChange:e=>m({...d,phone:e.target.value}),placeholder:"(555) 123-4567"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(r.zx,{onClick:N,variant:"primary",size:"sm",children:"Save Changes"}),(0,s.jsx)(r.zx,{onClick:()=>{o(!1),m({email:(null==t?void 0:t.email)||"",phone:(null==t?void 0:t.phone)||""})},variant:"outline",size:"sm",children:"Cancel"})]})]}):(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:d.email||"No email address"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:d.phone||"No phone number"})]})]})]}),k&&(0,s.jsxs)(r.Zb,{className:"p-6 bg-yellow-50 border-yellow-200",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4 text-yellow-800",children:"Digital Delivery Consent Required"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(r.XZ,{checked:h,onChange:e=>p(e.target.checked),className:"mt-1"}),(0,s.jsxs)("div",{className:"text-sm text-gray-700",children:[(0,s.jsx)("p",{className:"font-medium mb-2",children:"Patient consents to digital delivery of medical handouts"}),(0,s.jsx)("p",{children:"I authorize Ganger Dermatology to send my educational handouts via email and/or SMS. I understand that email and text messages are not secure forms of communication and there is a risk of interception. I accept this risk and consent to receive my handouts digitally."})]})]}),!h&&k&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:"Patient consent is required for digital delivery options"})]})]}),w&&!k&&(0,s.jsx)(r.Zb,{className:"p-4 bg-green-50 border-green-200",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("p",{className:"text-sm text-green-800 font-medium",children:"Patient has previously consented to digital communications"})]})}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(r.zx,{onClick:S,disabled:!b||g,variant:"primary",size:"lg",className:"px-8",children:g?"Saving...":"Generate & Deliver Handouts"})}),!b&&(0,s.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"Please select at least one delivery method and provide required contact information"})]})}var v=a(619);class j{static async loadTemplate(e){return({"acne-handout-kf":{title:"Acne Treatment Plan",content:[{type:"section",title:"Treatment Overview",content:[{type:"text",content:"This personalized treatment plan has been created specifically for {{patient_first_name}} {{patient_last_name}}."},{type:"text",content:"Follow these instructions carefully for the best results."}]}]},"sun-protection":{title:"Sun Protection Guidelines",content:[{type:"section",title:"UV Protection Basics",content:[{type:"list",subtype:"unordered",content:["Use SPF 30 or higher sunscreen daily","Reapply every 2 hours when outdoors","Wear protective clothing and wide-brimmed hats","Seek shade during peak hours (10 AM - 4 PM)"]}]}]}})[e]||{title:"Template Not Found",content:[{type:"text",content:"Template content could not be loaded."}]}}static processVariables(e,t){let a=e;return Object.entries(t).forEach(e=>{let[t,s]=e;a=a.replace(RegExp("{{".concat(t,"}}"),"g"),s||"")}),a}static renderContentBlock(e,t,a,s){let n=e.internal.pageSize.getWidth(),i=s;switch(t.type){case"section":if(t.title&&(e.setFontSize(14),e.setFont("helvetica","bold"),e.text(this.processVariables(t.title,a),20,i),i+=10),t.content&&Array.isArray(t.content))for(let s of t.content)i=this.renderContentBlock(e,s,a,i)+5;break;case"text":e.setFontSize(11),e.setFont("helvetica","normal");let r=this.processVariables(t.content,a),l=e.splitTextToSize(r,n-40);e.text(l,20,i),i+=6*l.length;break;case"list":e.setFontSize(11),e.setFont("helvetica","normal"),Array.isArray(t.content)&&t.content.forEach((s,r)=>{let l=this.processVariables(s,a),c="ordered"===t.subtype?"".concat(r+1,". "):"• ",o=e.splitTextToSize("".concat(c).concat(l),n-40-10);e.text(o,25,i),i+=6*o.length});break;default:if(t.content){e.setFontSize(11),e.setFont("helvetica","normal");let s=this.processVariables(t.content,a),r=e.splitTextToSize(s,n-40);e.text(r,20,i),i+=6*r.length}}return i>e.internal.pageSize.getHeight()-30&&(e.addPage(),i=30),i}static async generateHandouts(e){let t=new v.ZP;t.internal.pageSize.getWidth();let a={patient_full_name:"".concat(e.patient.firstName," ").concat(e.patient.lastName),patient_first_name:e.patient.firstName,patient_last_name:e.patient.lastName,patient_mrn:e.patient.mrn,patient_dob:e.patient.dateOfBirth||"",patient_email:e.patient.email||"",patient_phone:e.patient.phone||"",current_date:new Date().toLocaleDateString(),current_time:new Date().toLocaleTimeString(),current_datetime:new Date().toLocaleString(),...e.formData};for(let s=0;s<e.templates.length;s++){let n=e.templates[s];s>0&&t.addPage();let i=await this.loadTemplate(n.id),r=30;t.setFontSize(16),t.setFont("helvetica","bold"),t.text("Ganger Dermatology",20,r),t.setFontSize(10),t.setFont("helvetica","normal"),t.text("Patient Education Materials",20,r+8);let l="Patient: ".concat(a.patient_full_name," | MRN: ").concat(a.patient_mrn," | Date: ").concat(a.current_date);if(t.text(l,20,r+16),r+=30,t.setFontSize(18),t.setFont("helvetica","bold"),t.text(i.title,20,r),r+=15,i.content&&Array.isArray(i.content))for(let e of i.content)r=this.renderContentBlock(t,e,a,r)+8;let c=t.internal.pageSize.getHeight();t.setFontSize(8),t.setFont("helvetica","normal"),t.text("Generated on ".concat(a.current_datetime," | Page ").concat(s+1," of ").concat(e.templates.length),20,c-15)}return t.output("blob")}static async uploadPDF(e,t){return URL.createObjectURL(e)}static async sendEmail(e){try{if(!(await fetch("/api/handouts/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Email delivery failed")}catch(e){throw Error("Email delivery failed")}}static async sendSMS(e){try{let t="Hi ".concat(e.patientName,"! Your ").concat(e.templateCount," patient education handout").concat(1!==e.templateCount?"s":""," from Ganger Dermatology ").concat(1!==e.templateCount?"are":"is"," ready. Download: ").concat(e.downloadUrl," (Link expires in 72 hours)");if(!(await fetch("/api/handouts/send-sms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,message:t})})).ok)throw Error("SMS delivery failed")}catch(e){throw Error("SMS delivery failed")}}}function N(){let{user:e}=(0,i.aC)(),{generateHandouts:t,isGenerating:a}=function(){let{state:e,dispatch:t}=(0,m.F)(),[a,s]=(0,n.useState)(!1);return{generateHandouts:async a=>{try{s(!0);let n="gen_".concat(Date.now()),i={id:n,patientMRN:a.patient.mrn,templateIds:a.templateIds,generatedAt:new Date().toISOString(),deliveryMethods:Object.keys(a.deliveryOptions).filter(e=>a.deliveryOptions[e]),status:"generating",deliveryStatus:{print:!1,email:a.deliveryOptions.email?"pending":void 0,sms:a.deliveryOptions.sms?"pending":void 0}};t({type:"START_GENERATION",payload:i}),l.N9.show({type:"info",title:"Generating handouts...",message:"Creating personalized PDF documents"});let r=await j.generateHandouts({patient:a.patient,templates:e.templates.filter(e=>a.templateIds.includes(e.id)),formData:{}}),c=await j.uploadPDF(r,{patientMRN:a.patient.mrn,generationId:n});t({type:"COMPLETE_GENERATION",payload:{id:n,pdfUrl:c}});let o=[];a.deliveryOptions.print&&o.push(Promise.resolve().then(()=>{l.N9.show({type:"success",title:"Ready for printing",message:"Handouts are ready at the front desk printer"})})),a.deliveryOptions.email&&a.patient.email&&o.push(j.sendEmail({to:a.patient.email,patientName:"".concat(a.patient.firstName," ").concat(a.patient.lastName),pdfUrl:c,templateCount:a.templateIds.length}).then(()=>{t({type:"UPDATE_DELIVERY_STATUS",payload:{id:n,method:"email",status:"sent"}}),l.N9.show({type:"success",title:"Email sent",message:"Handouts sent to ".concat(a.patient.email)})}).catch(e=>{t({type:"UPDATE_DELIVERY_STATUS",payload:{id:n,method:"email",status:"failed"}}),l.N9.show({type:"error",title:"Email failed",message:"Failed to send email. Please try again."})})),a.deliveryOptions.sms&&a.patient.phone&&o.push(j.sendSMS({to:a.patient.phone,patientName:a.patient.firstName,downloadUrl:c,templateCount:a.templateIds.length}).then(()=>{t({type:"UPDATE_DELIVERY_STATUS",payload:{id:n,method:"sms",status:"sent"}}),l.N9.show({type:"success",title:"SMS sent",message:"Download link sent to ".concat(a.patient.phone)})}).catch(e=>{t({type:"UPDATE_DELIVERY_STATUS",payload:{id:n,method:"sms",status:"failed"}}),l.N9.show({type:"error",title:"SMS failed",message:"Failed to send text message. Please try again."})})),await Promise.allSettled(o),l.N9.show({type:"success",title:"Handouts generated successfully",message:"Created ".concat(a.templateIds.length," handout").concat(1!==a.templateIds.length?"s":""," for ").concat(a.patient.firstName," ").concat(a.patient.lastName)})}catch(a){e.currentGeneration&&t({type:"FAIL_GENERATION",payload:{id:e.currentGeneration.id,error:a instanceof Error?a.message:"Unknown error"}}),l.N9.show({type:"error",title:"Generation failed",message:"Failed to generate handouts. Please try again."})}finally{s(!1)}},isGenerating:a,currentGeneration:e.currentGeneration,recentHandouts:e.recentHandouts}}(),[c,o]=(0,n.useState)("patient"),[h,p]=(0,n.useState)(null),[g,y]=(0,n.useState)([]),[v,N]=(0,n.useState)({print:!0,email:!1,sms:!1}),[b,w]=(0,n.useState)(""),[k,S]=(0,n.useState)(!1);(0,n.useEffect)(()=>{l.co.track("handout_generator_opened","navigation",{user_role:null==e?void 0:e.role})},[e]);let _=async e=>{try{let t={id:"patient_".concat(Date.now(),"_qr"),mrn:e,firstName:"John",lastName:"Doe",email:"john.doe@example.com",phone:"+1234567890",dateOfBirth:"1980-01-01"};p(t),S(!1),o("templates"),l.co.track("patient_identified_qr","interaction",{mrn:t.mrn})}catch(e){}},C=async()=>{if(b.trim())try{let e={id:"patient_".concat(Date.now(),"_manual"),mrn:b.trim(),firstName:"Jane",lastName:"Smith",email:"jane.smith@example.com",phone:"+1987654321",dateOfBirth:"1975-05-15"};p(e),o("templates"),l.co.track("patient_identified_manual","interaction",{mrn:e.mrn})}catch(e){}},P=e=>{y(e),o("delivery"),l.co.track("templates_selected","interaction",{template_count:e.length,template_ids:e})},E=async()=>{if(h&&0!==g.length)try{o("generate"),await t({patient:h,templateIds:g,deliveryOptions:v}),l.co.track("handouts_generated","action",{patient_mrn:h.mrn,template_count:g.length,delivery_methods:Object.keys(v).filter(e=>v[e])}),o("patient"),p(null),y([]),w("")}catch(e){}};return(0,s.jsxs)(r.LN,{children:[(0,s.jsx)(r.mr,{title:"Generate Handouts",subtitle:"Create personalized patient education materials",actions:"patient"!==c&&"generate"!==c?(0,s.jsx)(r.zx,{onClick:()=>{let e=["patient","templates","delivery"],t=e.indexOf(c);t>0&&o(e[t-1])},variant:"outline",size:"sm",children:"Back"}):void 0}),(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)("div",{className:"flex items-center justify-between",children:[{key:"patient",label:"Patient"},{key:"templates",label:"Templates"},{key:"delivery",label:"Delivery"},{key:"generate",label:"Generate"}].map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(c===e.key?"bg-handouts-primary text-white":t<["patient","templates","delivery","generate"].indexOf(c)?"bg-green-500 text-white":"bg-gray-200 text-gray-600"),children:t+1}),(0,s.jsx)("span",{className:"ml-2 text-sm font-medium text-gray-700",children:e.label}),t<3&&(0,s.jsx)("div",{className:"w-16 h-0.5 bg-gray-200 mx-4"})]},e.key))})}),(()=>{switch(c){case"patient":return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(r.Zb,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Patient Identification"}),(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)(r.zx,{onClick:()=>S(!0),variant:"primary",className:"flex-1",children:"Scan QR Code"}),(0,s.jsx)("span",{className:"self-center text-gray-400",children:"or"}),(0,s.jsxs)("div",{className:"flex-1 flex gap-2",children:[(0,s.jsx)(r.II,{placeholder:"Enter MRN",value:b,onChange:e=>w(e.target.value),onKeyPress:e=>"Enter"===e.key&&C()}),(0,s.jsx)(r.zx,{onClick:C,variant:"outline",children:"Lookup"})]})]})})]}),k&&(0,s.jsx)(r.Zb,{className:"p-6",children:(0,s.jsx)(d,{onScanned:_,onCancel:()=>S(!1)})})]});case"templates":return(0,s.jsxs)("div",{className:"space-y-6",children:[h&&(0,s.jsx)(x,{patient:h}),(0,s.jsx)(u,{onSelectionChange:P,selectedTemplates:g})]});case"delivery":return(0,s.jsxs)("div",{className:"space-y-6",children:[h&&(0,s.jsx)(x,{patient:h}),(0,s.jsx)(f,{patient:h,options:v,onChange:N,onGenerate:E})]});case"generate":return(0,s.jsxs)("div",{className:"text-center space-y-6",children:[(0,s.jsx)(r.TK,{size:"lg"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Generating Handouts"}),(0,s.jsxs)("p",{className:"text-gray-600",children:["Creating personalized materials for ",null==h?void 0:h.firstName," ",null==h?void 0:h.lastName]})]})]});default:return null}})()]})}}},function(e){e.O(0,[835,294,946,34,930,848,649,874,888,774,179],function(){return e(e.s=8822)}),_N_E=e.O()}]);