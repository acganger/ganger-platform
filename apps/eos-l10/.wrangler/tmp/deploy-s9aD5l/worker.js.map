{
  "version": 3,
  "sources": ["../../../worker.js"],
  "sourceRoot": "/mnt/q/Projects/ganger-platform/apps/eos-l10/.wrangler/tmp/deploy-s9aD5l",
  "sourcesContent": ["/**\n * Cloudflare Worker for EOS L10 Management Platform R2 Deployment\n * Serves static Next.js build from R2 bucket storage\n * Pattern: Proven R2 deployment strategy\n */\n\nexport default {\n  async fetch(request, env, ctx) {\n    const url = new URL(request.url);\n    \n    // Health check endpoint\n    if (url.pathname === '/health') {\n      return new Response(JSON.stringify({\n        status: 'healthy',\n        timestamp: new Date().toISOString(),\n        service: 'eos-l10-management',\n        deployment: 'r2-cloudflare-workers'\n      }), {\n        headers: { 'Content-Type': 'application/json' }\n      });\n    }\n\n    // Handle root path\n    if (url.pathname === '/') {\n      url.pathname = '/index.html';\n    }\n    \n    // Handle directory paths (add index.html)\n    if (url.pathname.endsWith('/')) {\n      url.pathname += 'index.html';\n    }\n    \n    // Handle paths without extensions (Next.js routing)\n    if (!url.pathname.includes('.') && !url.pathname.endsWith('/')) {\n      url.pathname += '.html';\n    }\n\n    // Remove leading slash for R2 key\n    const key = url.pathname.startsWith('/') ? url.pathname.slice(1) : url.pathname;\n    \n    try {\n      // Attempt to get file from R2\n      const object = await env.EOS_L10_BUCKET.get(key);\n      \n      if (!object) {\n        // Try fallback to index.html for client-side routing\n        const indexObject = await env.EOS_L10_BUCKET.get('index.html');\n        if (indexObject) {\n          return new Response(indexObject.body, {\n            headers: {\n              'Content-Type': 'text/html',\n              'Cache-Control': 'public, max-age=86400',\n            },\n          });\n        }\n        \n        // Return 404\n        return new Response('Not Found', { status: 404 });\n      }\n\n      // Determine content type\n      const contentType = getContentType(key);\n      \n      return new Response(object.body, {\n        headers: {\n          'Content-Type': contentType,\n          'Cache-Control': getCacheControl(key),\n          'ETag': object.etag,\n        },\n      });\n      \n    } catch (error) {\n      console.error('R2 fetch error:', error);\n      return new Response('Internal Server Error', { status: 500 });\n    }\n  },\n};\n\nfunction getContentType(key) {\n  const ext = key.split('.').pop()?.toLowerCase();\n  const types = {\n    'html': 'text/html',\n    'css': 'text/css',\n    'js': 'application/javascript',\n    'json': 'application/json',\n    'png': 'image/png',\n    'jpg': 'image/jpeg',\n    'jpeg': 'image/jpeg',\n    'gif': 'image/gif',\n    'svg': 'image/svg+xml',\n    'ico': 'image/x-icon',\n    'woff': 'font/woff',\n    'woff2': 'font/woff2',\n    'ttf': 'font/ttf',\n    'eot': 'application/vnd.ms-fontobject',\n    'webmanifest': 'application/manifest+json'\n  };\n  return types[ext] || 'application/octet-stream';\n}\n\nfunction getCacheControl(key) {\n  // Static assets get longer cache\n  if (key.includes('/_next/static/')) {\n    return 'public, max-age=31536000, immutable';\n  }\n  \n  // Service worker gets short cache\n  if (key === 'sw.js' || key.endsWith('.js') && key.includes('workbox')) {\n    return 'public, max-age=0, must-revalidate';\n  }\n  \n  // HTML files get shorter cache for updates\n  if (key.endsWith('.html')) {\n    return 'public, max-age=86400';\n  }\n  \n  // Default cache\n  return 'public, max-age=86400';\n}"],
  "mappings": ";;;;AAMA,IAAO,iBAAQ;AAAA,EACb,MAAM,MAAM,SAAS,KAAK,KAAK;AAC7B,UAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAG/B,QAAI,IAAI,aAAa,WAAW;AAC9B,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,QAAQ;AAAA,QACR,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,SAAS;AAAA,QACT,YAAY;AAAA,MACd,CAAC,GAAG;AAAA,QACF,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH;AAGA,QAAI,IAAI,aAAa,KAAK;AACxB,UAAI,WAAW;AAAA,IACjB;AAGA,QAAI,IAAI,SAAS,SAAS,GAAG,GAAG;AAC9B,UAAI,YAAY;AAAA,IAClB;AAGA,QAAI,CAAC,IAAI,SAAS,SAAS,GAAG,KAAK,CAAC,IAAI,SAAS,SAAS,GAAG,GAAG;AAC9D,UAAI,YAAY;AAAA,IAClB;AAGA,UAAM,MAAM,IAAI,SAAS,WAAW,GAAG,IAAI,IAAI,SAAS,MAAM,CAAC,IAAI,IAAI;AAEvE,QAAI;AAEF,YAAM,SAAS,MAAM,IAAI,eAAe,IAAI,GAAG;AAE/C,UAAI,CAAC,QAAQ;AAEX,cAAM,cAAc,MAAM,IAAI,eAAe,IAAI,YAAY;AAC7D,YAAI,aAAa;AACf,iBAAO,IAAI,SAAS,YAAY,MAAM;AAAA,YACpC,SAAS;AAAA,cACP,gBAAgB;AAAA,cAChB,iBAAiB;AAAA,YACnB;AAAA,UACF,CAAC;AAAA,QACH;AAGA,eAAO,IAAI,SAAS,aAAa,EAAE,QAAQ,IAAI,CAAC;AAAA,MAClD;AAGA,YAAM,cAAc,eAAe,GAAG;AAEtC,aAAO,IAAI,SAAS,OAAO,MAAM;AAAA,QAC/B,SAAS;AAAA,UACP,gBAAgB;AAAA,UAChB,iBAAiB,gBAAgB,GAAG;AAAA,UACpC,QAAQ,OAAO;AAAA,QACjB;AAAA,MACF,CAAC;AAAA,IAEH,SAAS,OAAO;AACd,cAAQ,MAAM,mBAAmB,KAAK;AACtC,aAAO,IAAI,SAAS,yBAAyB,EAAE,QAAQ,IAAI,CAAC;AAAA,IAC9D;AAAA,EACF;AACF;AAEA,SAAS,eAAe,KAAK;AAC3B,QAAM,MAAM,IAAI,MAAM,GAAG,EAAE,IAAI,GAAG,YAAY;AAC9C,QAAM,QAAQ;AAAA,IACZ,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,OAAO;AAAA,IACP,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,OAAO;AAAA,IACP,OAAO;AAAA,IACP,eAAe;AAAA,EACjB;AACA,SAAO,MAAM,GAAG,KAAK;AACvB;AApBS;AAsBT,SAAS,gBAAgB,KAAK;AAE5B,MAAI,IAAI,SAAS,gBAAgB,GAAG;AAClC,WAAO;AAAA,EACT;AAGA,MAAI,QAAQ,WAAW,IAAI,SAAS,KAAK,KAAK,IAAI,SAAS,SAAS,GAAG;AACrE,WAAO;AAAA,EACT;AAGA,MAAI,IAAI,SAAS,OAAO,GAAG;AACzB,WAAO;AAAA,EACT;AAGA,SAAO;AACT;AAlBS;",
  "names": []
}
