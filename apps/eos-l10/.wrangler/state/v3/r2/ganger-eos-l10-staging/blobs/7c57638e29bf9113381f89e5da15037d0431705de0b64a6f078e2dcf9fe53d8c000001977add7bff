(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[431],{6713:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scorecard",function(){return s(8505)}])},2619:function(e,t,s){"use strict";s.d(t,{AJ:function(){return c},ZP:function(){return i}});var a=s(1549),r=s(4168),l=s(8107),n=s(5985);function i(e){let{page:t="dashboard",showCount:s=!0,showAvatars:i=!0,maxAvatars:c=5}=e,{onlineUsers:d}=(0,r.o)(t);if(0===d.length)return null;let o=d.slice(0,c),m=Math.max(0,d.length-c);return(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[i&&(0,a.jsxs)("div",{className:"flex -space-x-2",children:[o.map(e=>(0,a.jsxs)("div",{className:"relative",title:"".concat(e.full_name," - ").concat(e.page),children:[e.avatar_url?(0,a.jsx)("img",{src:e.avatar_url,alt:e.full_name,className:"w-8 h-8 rounded-full border-2 border-white bg-gray-100"}):(0,a.jsx)("div",{className:"w-8 h-8 rounded-full border-2 border-white bg-eos-100 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs font-medium text-eos-700",children:e.full_name.charAt(0).toUpperCase()})}),(0,a.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 border-2 border-white rounded-full"})]},e.user_id)),m>0&&(0,a.jsx)("div",{className:"w-8 h-8 rounded-full border-2 border-white bg-gray-200 flex items-center justify-center",children:(0,a.jsxs)("span",{className:"text-xs font-medium text-gray-600",children:["+",m]})})]}),s&&(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-600",children:[(0,a.jsx)(l.Z,{className:"w-2 h-2 fill-green-400 text-green-400"}),(0,a.jsxs)("span",{children:[d.length," online"]})]}),!i&&(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-600",children:[(0,a.jsx)(n.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:d.length})]})]})}function c(){let{onlineUsers:e}=(0,r.o)();return(0,a.jsxs)("div",{className:"hidden sm:flex items-center space-x-3 bg-white rounded-lg px-3 py-2 shadow-sm border",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(l.Z,{className:"w-2 h-2 fill-green-400 text-green-400"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600 font-medium",children:[e.length," team member",1!==e.length?"s":""," online"]})]}),e.length>0&&(0,a.jsxs)("div",{className:"flex -space-x-2",children:[e.slice(0,3).map(e=>(0,a.jsx)("div",{className:"relative",title:e.full_name,children:e.avatar_url?(0,a.jsx)("img",{src:e.avatar_url,alt:e.full_name,className:"w-6 h-6 rounded-full border-2 border-white"}):(0,a.jsx)("div",{className:"w-6 h-6 rounded-full border-2 border-white bg-eos-100 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs font-medium text-eos-700",children:e.full_name.charAt(0).toUpperCase()})})},e.user_id)),e.length>3&&(0,a.jsx)("div",{className:"w-6 h-6 rounded-full border-2 border-white bg-gray-200 flex items-center justify-center",children:(0,a.jsxs)("span",{className:"text-xs font-medium text-gray-600",children:["+",e.length-3]})})]})]})}},4168:function(e,t,s){"use strict";s.d(t,{o:function(){return n}});var a=s(4194),r=s(1700),l=s(1774);function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dashboard",{user:t,activeTeam:s}=(0,r.aC)(),[n,i]=(0,a.useState)([]),[c,d]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(!t||!s)return;let a="team-".concat(s.id),r=l.OQ.channel(a,{config:{presence:{key:t.id}}}),n=()=>{var s,a;let l={user_id:t.id,email:t.email||"",full_name:(null===(s=t.user_metadata)||void 0===s?void 0:s.full_name)||t.email||"",avatar_url:null===(a=t.user_metadata)||void 0===a?void 0:a.avatar_url,page:e,last_seen:new Date().toISOString()};d(l),r.track(l)};r.on("presence",{event:"sync"},()=>{let e=r.presenceState(),s=[];Object.keys(e).forEach(t=>{let a=e[t];if(a&&a.length>0){let e=a.reduce((e,t)=>{let s=t.last_seen||new Date().toISOString(),a=e.last_seen||new Date().toISOString();return new Date(s)>new Date(a)?t:e});s.push(e)}}),i(s.filter(e=>e.user_id!==(null==t?void 0:t.id)).sort((e,t)=>new Date(t.last_seen||new Date).getTime()-new Date(e.last_seen||new Date).getTime()))}).on("presence",{event:"join"},e=>{let{key:t,newPresences:s}=e}).on("presence",{event:"leave"},e=>{let{key:t,leftPresences:s}=e}).subscribe(async e=>{"SUBSCRIBED"===e&&n()});let c=setInterval(()=>{"joined"===r.state&&n()},3e4),o=()=>{"visible"===document.visibilityState&&n()};return document.addEventListener("visibilitychange",o),()=>{clearInterval(c),document.removeEventListener("visibilitychange",o),l.OQ.removeChannel(r)}},[t,s,e]),{onlineUsers:n,myPresence:c}}},8505:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return M}});var a=s(1549),r=s(4194),l=s(55),n=s.n(l),i=s(5560),c=s(1700),d=s(4168),o=s(755),m=s(2619),x=s(3616),u=s(4916),h=s(3843),g=s(361),f=s(7241),v=s(6138),j=s(119),p=s(2802),N=s(3553),y=s(6360);function b(e){var t;let{metric:s,entries:l,selectedWeek:n}=e,[i,c]=(0,r.useState)(!1),d=l.find(e=>e.week_ending===n),o=l.sort((e,t)=>new Date(e.week_ending).getTime()-new Date(t.week_ending).getTime()).slice(-13),m=e=>{switch(s.measurement_type){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);case"percentage":return"".concat(e,"%");case"boolean":return e?"Yes":"No";default:return e.toLocaleString()}},y=()=>{if(o.length<2)return"neutral";let e=o.slice(-3),t=o.slice(-6,-3);if(0===e.length||0===t.length)return"neutral";let s=e.reduce((e,t)=>e+t.value,0)/e.length,a=t.reduce((e,t)=>e+t.value,0)/t.length,r=(s-a)/a*100;return 5>Math.abs(r)?"neutral":r>0?"up":"down"};return(0,a.jsxs)("div",{className:"card group hover:shadow-lg transition-all duration-200",children:[(0,a.jsx)("div",{className:"card-header",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"card-title text-sm truncate",title:s.name,children:s.name}),s.description&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:s.description})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 ml-2",children:[(()=>{switch(y()){case"up":return(0,a.jsx)(g.Z,{className:"h-4 w-4 text-green-600"});case"down":return(0,a.jsx)(f.Z,{className:"h-4 w-4 text-red-600"});default:return(0,a.jsx)(h.Z,{className:"h-4 w-4 text-gray-600"})}})(),(0,a.jsx)("button",{onClick:()=>c(!i),className:"p-1 text-gray-400 hover:text-gray-600 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(v.Z,{className:"h-3 w-3"})})]})]})}),(0,a.jsxs)("div",{className:"card-content space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:d?m(d.value):"-"}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["Goal: ",m(s.goal)]})]}),d&&(0,a.jsxs)("div",{className:"px-3 py-1 rounded-full text-xs font-medium flex items-center space-x-1 ".concat((e=>{switch(e){case"green":return"text-green-600 bg-green-100";case"yellow":return"text-yellow-600 bg-yellow-100";case"red":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}})(d.status)),children:[(e=>{switch(e){case"green":return(0,a.jsx)(x.Z,{className:"h-4 w-4"});case"yellow":case"red":return(0,a.jsx)(u.Z,{className:"h-4 w-4"});default:return(0,a.jsx)(h.Z,{className:"h-4 w-4"})}})(d.status),(0,a.jsx)("span",{className:"capitalize",children:d.status})]})]}),d&&s.goal>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[(0,a.jsx)("span",{children:"Progress"}),(0,a.jsxs)("span",{children:[Math.round(d.value/s.goal*100),"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat("green"===d.status?"bg-green-500":"yellow"===d.status?"bg-yellow-500":"red"===d.status?"bg-red-500":"bg-gray-500"),style:{width:"".concat(Math.min(d.value/s.goal*100,100),"%")}})})]}),i&&o.length>1&&(0,a.jsx)("div",{className:"h-32",children:(0,a.jsx)(N.x1,{data:(()=>{let e=o.map(e=>new Date(e.week_ending).toLocaleDateString("en-US",{month:"short",day:"numeric"})),t=o.map(e=>e.value);return{labels:e,datasets:[{label:s.name,data:t,borderColor:(null==d?void 0:d.status)==="green"?"#10b981":(null==d?void 0:d.status)==="yellow"?"#f59e0b":(null==d?void 0:d.status)==="red"?"#ef4444":"#6b7280",backgroundColor:((null==d?void 0:d.status)==="green"?"#10b981":(null==d?void 0:d.status)==="yellow"?"#f59e0b":(null==d?void 0:d.status)==="red"?"#ef4444":"#6b7280")+"20",fill:!0,tension:.4,pointRadius:4,pointHoverRadius:6},{label:"Goal",data:Array(e.length).fill(s.goal),borderColor:"#374151",borderDash:[5,5],pointRadius:0,fill:!1}]}})(),options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>{let t=m(e.parsed.y);return"".concat(e.dataset.label,": ").concat(t)}}}},scales:{x:{display:!0,grid:{display:!1},ticks:{font:{size:11}}},y:{display:!0,grid:{color:"#f3f4f6"},ticks:{callback:e=>m(e),font:{size:11}}}},elements:{point:{hoverBackgroundColor:"#ffffff",hoverBorderWidth:2}}}})}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 pt-2 border-t border-gray-100",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(j.Z,{className:"h-3 w-3 mr-1"}),(0,a.jsx)("span",{className:"truncate",children:(null===(t=s.owner)||void 0===t?void 0:t.full_name)||"Unassigned"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(p.Z,{className:"h-3 w-3 mr-1"}),(0,a.jsx)("span",{className:"capitalize",children:s.frequency})]})]}),!d&&(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 text-yellow-600 mr-2"}),(0,a.jsx)("span",{className:"text-sm text-yellow-800",children:"No data for this week"})]})}),(null==d?void 0:d.notes)&&(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"text-xs text-blue-800",children:[(0,a.jsx)("strong",{children:"Notes:"})," ",d.notes]})})]})]})}y.kL.register(y.uw,y.f$,y.od,y.jn,y.Dx,y.u,y.De,y.Gu);var w=s(1774),_=s(7991),S=s(6468),k=s(6245);function D(e){let{scorecard:t,metrics:s,selectedWeek:l,existingEntries:n,onDataSaved:i}=e,{user:d}=(0,c.aC)(),[o,m]=(0,r.useState)({}),[h,g]=(0,r.useState)(!1),[f,v]=(0,r.useState)(new Set);(0,r.useEffect)(()=>{let e={};s.forEach(t=>{var s;let a=n.find(e=>e.metric_id===t.id);e[t.id]={metric_id:t.id,value:(null==a?void 0:null===(s=a.value)||void 0===s?void 0:s.toString())||"",notes:(null==a?void 0:a.notes)||"",status:(null==a?void 0:a.status)||j(t,(null==a?void 0:a.value)||0)}}),m(e)},[s,n]);let j=(e,t)=>{if(0===t)return"red";let s=t/e.goal*100;return s>=100?"green":s>=80?"yellow":"red"},N=(e,t,a)=>{m(r=>{let l={...r};if(l[e]={...l[e],[t]:a},"value"===t){let t=s.find(t=>t.id===e);if(t){let s=parseFloat(a)||0;l[e].status=j(t,s)}}return l})},y=(e,t)=>{switch(e.measurement_type){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);case"percentage":return"".concat(t,"%");case"boolean":return t?"Yes":"No";default:return t.toLocaleString()}},b=e=>{switch(e){case"green":return"bg-green-500 text-white";case"yellow":return"bg-yellow-500 text-white";case"red":return"bg-red-500 text-white"}},D=e=>{switch(e){case"green":return(0,a.jsx)(x.Z,{className:"h-5 w-5"});case"yellow":return(0,a.jsx)(u.Z,{className:"h-5 w-5"});case"red":return(0,a.jsx)(_.Z,{className:"h-5 w-5"})}},Z=async()=>{if(d){g(!0);try{let e=[],t=[];for(let[s,a]of Object.entries(o)){if(!a.value.trim())continue;let r=parseFloat(a.value)||0,i=n.find(e=>e.metric_id===s),c={metric_id:s,value:r,week_ending:l,notes:a.notes||null,status:a.status,entered_by:d.id,entered_at:new Date().toISOString()};i?e.push({...c,id:i.id}):t.push(c)}if(e.length>0)for(let t of e){let{error:e}=await w.OQ.from("scorecard_entries").update(t).eq("id",t.id);if(e)throw e}if(t.length>0){let{error:e}=await w.OQ.from("scorecard_entries").insert(t);if(e)throw e}i()}catch(e){alert("Failed to save entries. Please try again.")}finally{g(!1)}}},T=e=>{v(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"card-header",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h3",{className:"card-title",children:["Data Entry - Week Ending ",new Date(l+"T00:00:00").toLocaleDateString()]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[Object.values(o).filter(e=>e.value.trim()).length," of ",s.length," completed"]})]})}),(0,a.jsx)("div",{className:"card-content",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-gray-600",children:"Enter your weekly metrics below. Tap the status buttons to override automatic calculations."}),(0,a.jsx)("button",{onClick:Z,disabled:h||0===Object.values(o).filter(e=>e.value.trim()).length,className:"btn-primary flex items-center",children:h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.Z,{className:"h-4 w-4 mr-2"}),"Save Entries"]})})]})})]}),(0,a.jsx)("div",{className:"space-y-4",children:s.map(e=>{let t=o[e.id]||{metric_id:e.id,value:"",notes:"",status:"red"},s=f.has(e.id);return(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"card-content space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900",children:e.name}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-1"}),"Goal: ",y(e,e.goal)]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:e.frequency}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.measurement_type})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Value"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"number",inputMode:"decimal",value:t.value,onChange:t=>N(e.id,"value",t.target.value),placeholder:"Enter ".concat(e.measurement_type," value..."),className:"input text-3xl text-center py-4 pr-16",style:{minHeight:"60px"}}),"currency"===e.measurement_type&&(0,a.jsx)("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl text-gray-400",children:"$"}),"percentage"===e.measurement_type&&(0,a.jsx)("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl text-gray-400",children:"%"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2",children:["green","yellow","red"].map(s=>(0,a.jsxs)("button",{onClick:()=>N(e.id,"status",s),className:"p-3 rounded-lg border text-sm font-medium flex items-center justify-center space-x-2 transition-all ".concat(t.status===s?"".concat(b(s)," border-transparent"):"border-gray-200 text-gray-700 hover:bg-gray-50"),children:[D(s),(0,a.jsx)("span",{className:"capitalize",children:s})]},s))})]}),t.value&&e.goal>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[(0,a.jsx)("span",{children:"Progress to Goal"}),(0,a.jsxs)("span",{children:[Math.round(parseFloat(t.value)/e.goal*100),"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,a.jsx)("div",{className:"h-3 rounded-full transition-all duration-300 ".concat("green"===t.status?"bg-green-500":"yellow"===t.status?"bg-yellow-500":"bg-red-500"),style:{width:"".concat(Math.min(parseFloat(t.value)/e.goal*100,100),"%")}})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("button",{onClick:()=>T(e.id),className:"flex items-center text-sm text-gray-600 hover:text-gray-900",children:[(0,a.jsx)(k.Z,{className:"h-4 w-4 mr-1"}),"Add Notes ",t.notes&&"(has notes)"]}),s&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("textarea",{value:t.notes,onChange:t=>N(e.id,"notes",t.target.value),placeholder:"Add context, explanations, or action items...",rows:3,className:"input text-sm"})})]})]})},e.id)})}),(0,a.jsx)("div",{className:"card bg-blue-50 border-blue-200",children:(0,a.jsx)("div",{className:"card-content",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-blue-900",children:"Weekly Summary"}),(0,a.jsxs)("p",{className:"text-sm text-blue-700",children:[Object.values(o).filter(e=>e.value.trim()).length," of ",s.length," metrics entered"]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-4",children:Object.values(o).reduce((e,t)=>(t.value.trim()&&(e[t.status]=(e[t.status]||0)+1),e),{})&&Object.entries(Object.values(o).reduce((e,t)=>(t.value.trim()&&(e[t.status]=(e[t.status]||0)+1),e),{})).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("green"===t?"bg-green-500":"yellow"===t?"bg-yellow-500":"bg-red-500")}),(0,a.jsx)("span",{className:"text-sm text-blue-700",children:s})]},t)})})]})})})]})}var Z=s(2761);function T(e){var t;let{metrics:s,entries:l,selectedWeek:n}=e,[i,c]=(0,r.useState)((null===(t=s[0])||void 0===t?void 0:t.id)||""),[d,o]=(0,r.useState)("overview"),m=(()=>{let e=[],t=new Date;for(let s=12;s>=0;s--){let a=new Date(t);a.setDate(t.getDate()-(t.getDay()+7*s)),e.push(a.toISOString().split("T")[0])}return e})(),u=s.find(e=>e.id===i),h=(e,t)=>{switch(e.measurement_type){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);case"percentage":return"".concat(t,"%");case"boolean":return t?"Yes":"No";default:return t.toLocaleString()}},g=()=>{let e=l.filter(e=>e.week_ending===n),t=s.map(e=>e.name.length>15?e.name.substring(0,15)+"...":e.name),a=s.map(t=>{let s=e.find(e=>e.metric_id===t.id);return s?s.value/t.goal*100:0}),r=s.map(t=>{let s=e.find(e=>e.metric_id===t.id);if(!s)return"#6b7280";switch(s.status){case"green":return"#10b981";case"yellow":return"#f59e0b";case"red":return"#ef4444";default:return"#6b7280"}});return{labels:t,datasets:[{label:"Goal Achievement %",data:a,backgroundColor:r,borderColor:r.map(e=>e+"dd"),borderWidth:1}]}},f={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},tooltip:{callbacks:{label:e=>u&&"line"===d?"".concat(e.dataset.label,": ").concat(h(u,e.parsed.y)):"".concat(e.dataset.label,": ").concat(e.parsed.y,"%")}}},scales:"overview"!==d?{}:{x:{grid:{display:!1}},y:{beginAtZero:!0,max:150,ticks:{callback:e=>"".concat(e,"%")}}}},v={...f,plugins:{...f.plugins,legend:{display:!1}}},j=(()=>{let e=[],t=l.filter(e=>e.week_ending===n),a=t.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{}),r=t.length,i=(a.green||0)/r*100;return i>=80?e.push({type:"success",title:"Strong Performance",description:"".concat(Math.round(i),"% of metrics are hitting targets this week.")}):i>=60?e.push({type:"warning",title:"Mixed Performance",description:"".concat(Math.round(i),"% of metrics on track. Some areas need attention.")}):e.push({type:"danger",title:"Performance Alert",description:"Only ".concat(Math.round(i),"% of metrics hitting targets. Review needed.")}),s.forEach(t=>{let s=l.filter(e=>e.metric_id===t.id).sort((e,t)=>new Date(e.week_ending).getTime()-new Date(t.week_ending).getTime()).slice(-4);if(s.length>=3){let a=s.slice(-2),r=s.slice(-4,-2),l=a.reduce((e,t)=>e+t.value,0)/a.length,n=r.reduce((e,t)=>e+t.value,0)/r.length,i=(l-n)/n*100;Math.abs(i)>20&&e.push({type:i>0?"success":"warning",title:"".concat(t.name," ").concat(i>0?"Improving":"Declining"),description:"".concat(Math.round(Math.abs(i)),"% ").concat(i>0?"increase":"decrease"," in recent weeks.")})}}),e.slice(0,5)})();return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"card",children:(0,a.jsx)("div",{className:"card-header",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsx)("h3",{className:"card-title",children:"Trend Analysis"}),(0,a.jsxs)("div",{className:"mt-3 sm:mt-0 flex items-center space-x-3",children:[(0,a.jsxs)("select",{value:d,onChange:e=>o(e.target.value),className:"input text-sm",children:[(0,a.jsx)("option",{value:"overview",children:"Team Overview"}),(0,a.jsx)("option",{value:"line",children:"Metric Trend"}),(0,a.jsx)("option",{value:"bar",children:"Goal Achievement"})]}),"line"===d&&(0,a.jsx)("select",{value:i,onChange:e=>c(e.target.value),className:"input text-sm",children:s.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))})]})]})})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"card-header",children:(0,a.jsxs)("h4",{className:"card-title text-base",children:["overview"===d&&"Team Performance Overview","line"===d&&"".concat(null==u?void 0:u.name," Trend"),"bar"===d&&"Goal Achievement by Metric"]})}),(0,a.jsx)("div",{className:"card-content",children:(0,a.jsxs)("div",{className:"h-64",children:["overview"===d&&(0,a.jsx)(N.$Q,{data:g(),options:v}),"line"===d&&u&&(0,a.jsx)(N.x1,{data:(()=>{if(!u)return null;let e=l.filter(e=>e.metric_id===i),t=m.map(t=>{let s=e.find(e=>e.week_ending===t);return s?s.value:null});return{labels:m.map(e=>new Date(e+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})),datasets:[{label:u.name,data:t,borderColor:"#3b82f6",backgroundColor:"#3b82f620",fill:!0,tension:.4,pointRadius:4,pointHoverRadius:6,spanGaps:!0},{label:"Goal",data:Array(m.length).fill(u.goal),borderColor:"#ef4444",borderDash:[5,5],pointRadius:0,fill:!1}]}})(),options:f}),"bar"===d&&(0,a.jsx)(N.$Q,{data:g(),options:v})]})})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"card-header",children:(0,a.jsx)("h4",{className:"card-title text-base",children:"Status Distribution"})}),(0,a.jsx)("div",{className:"card-content",children:(0,a.jsx)("div",{className:"h-48",children:(0,a.jsx)(N.$I,{data:(()=>{let e=l.filter(e=>e.week_ending===n).reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{});return{labels:["Green","Yellow","Red"],datasets:[{data:[e.green||0,e.yellow||0,e.red||0],backgroundColor:["#10b981","#f59e0b","#ef4444"],borderColor:["#ffffff","#ffffff","#ffffff"],borderWidth:2}]}})(),options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})})})]})})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"card-header",children:(0,a.jsx)("h4",{className:"card-title",children:"Performance Insights"})}),(0,a.jsx)("div",{className:"card-content",children:0===j.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-4",children:"Enter more data to generate performance insights."}):(0,a.jsx)("div",{className:"space-y-3",children:j.map((e,t)=>(0,a.jsx)("div",{className:"p-4 rounded-lg border-l-4 ".concat("success"===e.type?"bg-green-50 border-green-400":"warning"===e.type?"bg-yellow-50 border-yellow-400":"bg-red-50 border-red-400"),children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsxs)("div",{className:"mr-3 ".concat("success"===e.type?"text-green-600":"warning"===e.type?"text-yellow-600":"text-red-600"),children:["success"===e.type&&(0,a.jsx)(x.Z,{className:"h-5 w-5"}),"warning"===e.type&&(0,a.jsx)(Z.Z,{className:"h-5 w-5"}),"danger"===e.type&&(0,a.jsx)(Z.Z,{className:"h-5 w-5"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"font-medium ".concat("success"===e.type?"text-green-800":"warning"===e.type?"text-yellow-800":"text-red-800"),children:e.title}),(0,a.jsx)("p",{className:"text-sm mt-1 ".concat("success"===e.type?"text-green-700":"warning"===e.type?"text-yellow-700":"text-red-700"),children:e.description})]})]})},t))})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"card-content text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:l.filter(e=>e.week_ending===n).length}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Entries This Week"})]})}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"card-content text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:l.filter(e=>e.week_ending===n&&"green"===e.status).length}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"On Target"})]})}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"card-content text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:l.filter(e=>e.week_ending===n&&"yellow"===e.status).length}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"At Risk"})]})}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"card-content text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:l.filter(e=>e.week_ending===n&&"red"===e.status).length}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Below Target"})]})})]})]})}y.kL.register(y.uw,y.f$,y.od,y.jn,y.ZL,y.Dx,y.u,y.De,y.Gu,y.qi);var C=s(8504),E=s(4581),O=s(4032),A=s(4272);function M(){let{activeTeam:e,user:t,userRole:s}=(0,c.aC)(),{onlineUsers:l}=(0,d.o)("scorecard"),[x,u]=(0,r.useState)(null),[h,g]=(0,r.useState)([]),[f,v]=(0,r.useState)([]),[j,p]=(0,r.useState)(!0),[N,y]=(0,r.useState)(null),[_,S]=(0,r.useState)(""),[k,Z]=(0,r.useState)(!1),[M,F]=(0,r.useState)(!1),I=()=>{let e=new Date,t=new Date(e);return t.setDate(e.getDate()-e.getDay()),t.toISOString().split("T")[0]};(0,r.useEffect)(()=>{e&&(P(),_||S(I()))},[e]),(0,r.useEffect)(()=>{e&&x&&R()},[e,x]);let P=async()=>{if(e)try{p(!0),y(null);let{data:t,error:s}=await w.OQ.from("scorecards").select("*").eq("team_id",e.id).eq("active",!0).single();if(s&&"PGRST116"===s.code){let{data:s,error:a}=await w.OQ.from("scorecards").insert({team_id:e.id,name:"".concat(e.name," Scorecard"),description:"Team performance metrics",active:!0}).select().single();if(a)throw a;t=s}else if(s)throw s;u(t);let{data:a,error:r}=await w.OQ.from("scorecard_metrics").select("\n          *,\n          owner:users(full_name, email, avatar_url)\n        ").eq("scorecard_id",t.id).eq("active",!0).order("sort_order");if(r)throw r;g(a||[]);let l=new Date;l.setDate(l.getDate()-91);let{data:n,error:i}=await w.OQ.from("scorecard_entries").select("\n          *,\n          metric:scorecard_metrics(name, goal, measurement_type)\n        ").in("metric_id",(null==a?void 0:a.map(e=>e.id))||[]).gte("week_ending",l.toISOString().split("T")[0]).order("week_ending",{ascending:!1});if(i)throw i;v(n||[])}catch(e){y(e instanceof Error?e.message:"Failed to load scorecard")}finally{p(!1)}},R=()=>{if(!e||!x)return;let t=w.OQ.channel("scorecard-".concat(e.id)).on("postgres_changes",{event:"*",schema:"public",table:"scorecard_entries",filter:"metric_id=in.(".concat(h.map(e=>e.id).join(","),")")},e=>{"INSERT"===e.eventType||"UPDATE"===e.eventType?v(t=>{let s=e.new,a=t.findIndex(e=>e.id===s.id);if(!(a>=0))return[s,...t];{let e=[...t];return e[a]=s,e}}):"DELETE"===e.eventType&&v(t=>t.filter(t=>t.id!==e.old.id))}).subscribe();return()=>t.unsubscribe()},L=async()=>{F(!0),await P(),F(!1)},U=e=>f.filter(t=>t.week_ending===e),G=()=>{let e=U(_);if(0===e.length)return"gray";let t=e.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{});return t.red>0?"red":t.yellow>0?"yellow":"green"};return j?(0,a.jsx)(c.a1,{children:(0,a.jsx)(c.P6,{children:(0,a.jsx)(o.Z,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"skeleton h-8 w-64"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[...Array(6)].map((e,t)=>(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"card-content space-y-4",children:[(0,a.jsx)("div",{className:"skeleton h-6 w-full"}),(0,a.jsx)("div",{className:"skeleton h-16 w-full"}),(0,a.jsx)("div",{className:"skeleton h-4 w-3/4"})]})},t))})]})})})}):(0,a.jsx)(c.a1,{children:(0,a.jsx)(c.P6,{children:(0,a.jsxs)("div",{children:[(0,a.jsxs)(n(),{children:[(0,a.jsx)("title",{children:"Scorecard - EOS L10 Platform"}),(0,a.jsx)("meta",{name:"description",content:"Team scorecard metrics and analytics"})]}),(0,a.jsx)(o.Z,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[(0,a.jsx)(C.Z,{className:"h-6 w-6 mr-2 text-eos-600"}),"Scorecard"]}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Weekly metrics and performance tracking"})]}),(0,a.jsxs)("div",{className:"mt-4 sm:mt-0 flex items-center space-x-3",children:[(0,a.jsx)(m.ZP,{page:"scorecard"}),(0,a.jsxs)("button",{onClick:L,disabled:M,className:"btn-secondary flex items-center",children:[(0,a.jsx)(E.Z,{className:"h-4 w-4 mr-2 ".concat(M?"animate-spin":"")}),"Refresh"]}),("leader"===s||"member"===s)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>Z(!k),className:"btn-primary flex items-center",children:[(0,a.jsx)(O.Z,{className:"h-4 w-4 mr-2"}),k?"View Analytics":"Enter Data"]}),(0,a.jsxs)(i.Z,{href:"/scorecard/metrics",className:"btn-secondary flex items-center",children:[(0,a.jsx)(A.Z,{className:"h-4 w-4 mr-2"}),"Metrics"]})]})]})]}),N&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,a.jsxs)("p",{className:"text-red-800 text-sm",children:["Error: ",N]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"card-header",children:(0,a.jsx)("h3",{className:"card-title text-sm",children:"Week Ending"})}),(0,a.jsx)("div",{className:"card-content",children:(0,a.jsx)("select",{value:_,onChange:e=>S(e.target.value),className:"input",children:(()=>{let e=[],t=new Date;for(let s=0;s<13;s++){let a=new Date(t);a.setDate(t.getDate()-(t.getDay()+7*s)),e.push(a.toISOString().split("T")[0])}return e})().map(e=>(0,a.jsx)("option",{value:e,children:new Date(e+"T00:00:00").toLocaleDateString()},e))})})]}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"card-content text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:h.length}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Total Metrics"})]})}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"card-content text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:[0===h.length?0:Math.round(new Set(U(_).map(e=>e.metric_id)).size/h.length*100),"%"]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Data Compliance"})]})}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"card-content text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold ".concat("green"===G()?"text-green-600":"yellow"===G()?"text-yellow-600":"red"===G()?"text-red-600":"text-gray-600"),children:G().toUpperCase()}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Overall Status"})]})})]}),k?(0,a.jsx)(D,{scorecard:x,metrics:h,selectedWeek:_,existingEntries:U(_),onDataSaved:P}):(0,a.jsxs)(a.Fragment,{children:[0===h.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(C.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No metrics configured"}),(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"Set up your scorecard metrics to start tracking performance"}),("leader"===s||"member"===s)&&(0,a.jsxs)(i.Z,{href:"/scorecard/metrics",className:"btn-primary",children:[(0,a.jsx)(O.Z,{className:"h-4 w-4 mr-2"}),"Add Metrics"]})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:h.map(e=>(0,a.jsx)(b,{metric:e,entries:f.filter(t=>t.metric_id===e.id),selectedWeek:_},e.id))}),h.length>0&&f.length>0&&(0,a.jsx)(T,{metrics:h,entries:f,selectedWeek:_})]})]})})]})})})}}},function(e){e.O(0,[580,509,755,888,774,179],function(){return e(e.s=6713)}),_N_E=e.O()}]);