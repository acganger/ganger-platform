(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[874],{3735:function(e,l,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/calls/journal",function(){return a(8133)}])},8133:function(e,l,a){"use strict";a.r(l);var r=a(1549),t=a(4194),n=a(7311),i=a(8848);let s={call_id:"",call_summary:"",detailed_notes:"",patient_concern:"",resolution_provided:"",action_items:[],follow_up_required:!1,follow_up_type:"",follow_up_date:"",follow_up_notes:"",call_tags:[],department_involved:[],referral_made:!1,referral_type:""},o=["Appointment Scheduling","Insurance Question","Billing Inquiry","Prescription Request","Test Results","General Information","Complaint","Emergency","Follow-up","Cancellation"],c=["Front Desk","Clinical","Billing","Insurance","Provider","Lab","Pharmacy","Imaging"],d=[{value:"callback",label:"Callback Required"},{value:"appointment",label:"Appointment Needed"},{value:"provider_review",label:"Provider Review"},{value:"billing",label:"Billing Follow-up"}],u=[{value:"internal",label:"Internal Department"},{value:"external",label:"External Provider"},{value:"specialist",label:"Specialist Referral"},{value:"emergency",label:"Emergency Services"}];l.default=(0,n.FF)(function(){let{user:e}=(0,n.aC)(),[l,a]=(0,t.useState)(s),[m,p]=(0,t.useState)([]),[h,_]=(0,t.useState)(!1),[x,f]=(0,t.useState)(!1),[v,y]=(0,t.useState)({});(0,t.useEffect)(()=>{b()},[]);let b=async()=>{try{let l=await fetch("/api/call-records?limit=20&agent_email="+(null==e?void 0:e.email)),a=await l.json();p(a.data||[])}catch(e){}},j=e=>{let l=m.find(l=>l.id===e);l&&a(a=>({...a,call_id:e,call_summary:l.call_outcome||"",patient_concern:l.call_outcome||""}))},g=(e,l)=>{a(a=>({...a,[e]:l})),v[e]&&y(l=>({...l,[e]:""}))},w=(e,l)=>{g(e,l.split(",").map(e=>e.trim()).filter(Boolean))},C=(e,a)=>{let r=l[a];g(a,r.includes(e)?r.filter(l=>l!==e):[...r,e])},N=()=>{let e={};return l.call_id||(e.call_id="Please select a call to journal"),l.call_summary.trim()||(e.call_summary="Call summary is required"),l.patient_concern.trim()||(e.patient_concern="Patient concern is required"),l.resolution_provided.trim()||(e.resolution_provided="Resolution provided is required"),l.follow_up_required&&!l.follow_up_type&&(e.follow_up_type="Follow-up type is required when follow-up is needed"),l.referral_made&&!l.referral_type&&(e.referral_type="Referral type is required when referral is made"),y(e),0===Object.keys(e).length},D=async r=>{if(r.preventDefault(),N()){_(!0);try{if(!(await fetch("/api/call-journals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...l,agent_email:null==e?void 0:e.email})})).ok)throw Error("Failed to submit journal entry");f(!0),a(s),b()}catch(e){y({submit:"Failed to submit journal entry. Please try again."})}finally{_(!1)}}},S=async()=>{try{await fetch("/api/call-journals/draft",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...l,agent_email:null==e?void 0:e.email,journal_status:"draft"})})}catch(e){}};return(0,r.jsxs)(i.LN,{children:[(0,r.jsx)(i.mr,{title:"Call Journal",subtitle:"Document call outcomes and patient interactions",actions:(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)(i.zx,{variant:"outline",onClick:S,disabled:!l.call_summary.trim(),children:"\uD83D\uDCBE Save Draft"}),(0,r.jsx)(i.zx,{variant:"outline",onClick:()=>window.location.href="/calls/history",children:"\uD83D\uDCDE Call History"})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsx)(i.Zb,{className:"p-6",children:(0,r.jsxs)("form",{onSubmit:D,className:"space-y-6",children:[(0,r.jsx)(i.Wi,{label:"Select Call",required:!0,error:v.call_id,children:(0,r.jsx)(i.Ph,{value:l.call_id,onChange:e=>j(e.target.value),options:[{value:"",label:"Select a recent call..."},...m.map(e=>({value:e.id,label:"".concat(e.caller_name||"Unknown"," - ").concat(new Date(e.call_start_time).toLocaleString())}))],placeholder:"Choose call to journal"})}),(0,r.jsx)(i.Wi,{label:"Call Summary",required:!0,error:v.call_summary,children:(0,r.jsx)(i.II,{value:l.call_summary,onChange:e=>g("call_summary",e),placeholder:"Brief summary of the call purpose and outcome"})}),(0,r.jsx)(i.Wi,{label:"Patient Concern",required:!0,error:v.patient_concern,children:(0,r.jsx)(i.II,{value:l.patient_concern,onChange:e=>g("patient_concern",e),placeholder:"Primary patient concern or request"})}),(0,r.jsx)(i.Wi,{label:"Resolution Provided",required:!0,error:v.resolution_provided,children:(0,r.jsx)("textarea",{className:"w-full min-h-[100px] p-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",value:l.resolution_provided,onChange:e=>g("resolution_provided",e.target.value),placeholder:"How the concern was addressed and what information was provided"})}),(0,r.jsx)(i.Wi,{label:"Detailed Notes",children:(0,r.jsx)("textarea",{className:"w-full min-h-[120px] p-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",value:l.detailed_notes,onChange:e=>g("detailed_notes",e.target.value),placeholder:"Additional details about the interaction..."})}),(0,r.jsx)(i.Wi,{label:"Action Items (comma-separated)",children:(0,r.jsx)(i.II,{value:l.action_items.join(", "),onChange:e=>w("action_items",e.target.value),placeholder:"e.g. Schedule follow-up call, Send insurance information"})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(i.XZ,{checked:l.follow_up_required,onChange:e=>g("follow_up_required",e),label:"Follow-up Required"}),l.follow_up_required&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 ml-6",children:[(0,r.jsx)(i.Wi,{label:"Follow-up Type",required:!0,error:v.follow_up_type,children:(0,r.jsx)(i.Ph,{value:l.follow_up_type,onChange:e=>g("follow_up_type",e.target.value),options:d,placeholder:"Select follow-up type"})}),(0,r.jsx)(i.Wi,{label:"Follow-up Date",children:(0,r.jsx)(i.II,{type:"date",value:l.follow_up_date,onChange:e=>g("follow_up_date",e)})}),(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsx)(i.Wi,{label:"Follow-up Notes",children:(0,r.jsx)(i.II,{value:l.follow_up_notes,onChange:e=>g("follow_up_notes",e),placeholder:"Notes about the required follow-up"})})})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(i.XZ,{checked:l.referral_made,onChange:e=>g("referral_made",e),label:"Referral Made"}),l.referral_made&&(0,r.jsx)("div",{className:"ml-6",children:(0,r.jsx)(i.Wi,{label:"Referral Type",required:!0,error:v.referral_type,children:(0,r.jsx)(i.Ph,{value:l.referral_type,onChange:e=>g("referral_type",e.target.value),options:u,placeholder:"Select referral type"})})})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)(i.zx,{type:"button",variant:"outline",onClick:()=>window.location.href="/calls/history",children:"Cancel"}),(0,r.jsx)(i.zx,{type:"submit",variant:"primary",disabled:h,children:h?(0,r.jsx)(i.TK,{size:"sm"}):"\uD83D\uDCDD Submit Journal"})]}),v.submit&&(0,r.jsx)("div",{className:"text-red-600 text-sm mt-2",children:v.submit})]})})}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(i.Zb,{className:"p-4",children:[(0,r.jsx)("h3",{className:"font-medium text-neutral-900 mb-3",children:"Call Tags"}),(0,r.jsx)("div",{className:"space-y-2",children:o.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>C(e,"call_tags"),className:"w-full text-left px-3 py-2 text-sm rounded-lg border transition-colors ".concat(l.call_tags.includes(e)?"bg-primary-50 border-primary-200 text-primary-700":"bg-white border-neutral-200 text-neutral-700 hover:bg-neutral-50"),children:[l.call_tags.includes(e)?"✓ ":"",e]},e))})]}),(0,r.jsxs)(i.Zb,{className:"p-4",children:[(0,r.jsx)("h3",{className:"font-medium text-neutral-900 mb-3",children:"Departments Involved"}),(0,r.jsx)("div",{className:"space-y-2",children:c.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>C(e,"department_involved"),className:"w-full text-left px-3 py-2 text-sm rounded-lg border transition-colors ".concat(l.department_involved.includes(e)?"bg-secondary-50 border-secondary-200 text-secondary-700":"bg-white border-neutral-200 text-neutral-700 hover:bg-neutral-50"),children:[l.department_involved.includes(e)?"✓ ":"",e]},e))})]}),(0,r.jsxs)(i.Zb,{className:"p-4",children:[(0,r.jsx)("h3",{className:"font-medium text-neutral-900 mb-3",children:"Quick Actions"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(i.zx,{variant:"outline",size:"sm",onClick:()=>a(s),className:"w-full",children:"\uD83D\uDDD1️ Clear Form"}),(0,r.jsx)(i.zx,{variant:"outline",size:"sm",onClick:S,className:"w-full",disabled:!l.call_summary.trim(),children:"\uD83D\uDCBE Save as Draft"})]})]})]})]}),(0,r.jsx)(i.u_,{isOpen:x,onClose:()=>f(!1),title:"Journal Submitted Successfully",children:(0,r.jsxs)("div",{className:"text-center py-4",children:[(0,r.jsx)("div",{className:"text-green-600 text-6xl mb-4",children:"✅"}),(0,r.jsx)("p",{className:"text-neutral-700 mb-6",children:"Your call journal has been submitted successfully and is now available for supervisor review."}),(0,r.jsxs)("div",{className:"flex space-x-3 justify-center",children:[(0,r.jsx)(i.zx,{variant:"outline",onClick:()=>{f(!1),a(s)},children:"Create Another Journal"}),(0,r.jsx)(i.zx,{variant:"primary",onClick:()=>window.location.href="/calls/history",children:"View Call History"})]})]})})]})},{requiredRoles:["staff","manager","superadmin"]})}},function(e){e.O(0,[946,848,888,774,179],function(){return e(e.s=3735)}),_N_E=e.O()}]);