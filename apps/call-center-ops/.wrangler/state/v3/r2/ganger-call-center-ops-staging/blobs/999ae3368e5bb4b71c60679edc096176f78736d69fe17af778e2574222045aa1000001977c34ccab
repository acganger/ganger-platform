(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[124],{7168:function(e,a,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/calls/history",function(){return l(2194)}])},2194:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return u}});var t=l(1549),n=l(4194),s=l(7311),i=l(8848);let r=e=>new Date(e).toLocaleDateString(),o=e=>new Date(e).toLocaleTimeString(),c=function(e){if(e<60)return"".concat(e,"s");let a=Math.floor(e/60),l=e%60;if(a<60)return l>0?"".concat(a,"m ").concat(l,"s"):"".concat(a,"m");let t=Math.floor(a/60),n=a%60;return n>0?"".concat(t,"h ").concat(n,"m"):"".concat(t,"h")};function d(e){let{call:a,journal:l,onClose:n}=e;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-neutral-900 mb-2",children:"Call Information"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Date/Time:"})," ",r(a.call_start_time)," at ",o(a.call_start_time)]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Caller:"})," ",a.caller_name||"Unknown"," (",a.caller_phone,")"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Direction:"})," ",a.call_direction]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Location:"})," ",a.location]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Duration:"})," ",c(a.talk_duration_seconds||0)]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-neutral-900 mb-2",children:"Call Outcome"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Status:"})," ",a.call_status]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Outcome:"})," ",a.call_outcome||"No outcome recorded"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Quality Score:"})," ",a.quality_score?"".concat(a.quality_score,"%"):"Not scored"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"First Call Resolution:"})," ",a.first_call_resolution?"Yes":"No"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Follow-up Required:"})," ",a.follow_up_required?"Yes":"No"]})]})]})]}),a.patient_mrn&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-neutral-900 mb-2",children:"Patient Information"}),(0,t.jsx)("div",{className:"bg-neutral-50 p-4 rounded-lg",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Patient MRN:"})," ",a.patient_mrn]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Appointment Scheduled:"})," ",a.appointment_scheduled?"Yes":"No"]}),a.appointment_date&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Appointment Date:"})," ",r(a.appointment_date)]}),a.provider_requested&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Provider Requested:"})," ",a.provider_requested]})]})})]}),l?(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-neutral-900 mb-2",children:"Call Journal"}),(0,t.jsxs)("div",{className:"bg-neutral-50 p-4 rounded-lg space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Summary:"}),(0,t.jsx)("p",{className:"mt-1 text-sm",children:l.call_summary})]}),l.detailed_notes&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Detailed Notes:"}),(0,t.jsx)("p",{className:"mt-1 text-sm",children:l.detailed_notes})]}),l.patient_concern&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Patient Concern:"}),(0,t.jsx)("p",{className:"mt-1 text-sm",children:l.patient_concern})]}),l.resolution_provided&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Resolution Provided:"}),(0,t.jsx)("p",{className:"mt-1 text-sm",children:l.resolution_provided})]}),l.call_tags.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Tags:"}),(0,t.jsx)("div",{className:"mt-1 flex flex-wrap gap-1",children:l.call_tags.map((e,a)=>(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:e},a))})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm text-neutral-500 pt-2 border-t",children:[(0,t.jsxs)("span",{children:["Status: ",l.journal_status]}),(0,t.jsxs)("span",{children:["Submitted: ",r(l.created_at)]})]})]})]}):(0,t.jsxs)("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[(0,t.jsx)("p",{className:"text-amber-800",children:"No journal entry found for this call."}),(0,t.jsx)(i.zx,{size:"sm",variant:"primary",className:"mt-2",onClick:()=>window.location.href="/calls/journal?call_id=".concat(a.id),children:"Create Journal Entry"})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[a.recording_available&&(0,t.jsx)(i.zx,{variant:"outline",onClick:()=>window.open(a.recording_url,"_blank"),children:"\uD83C\uDFB5 Play Recording"}),(0,t.jsx)(i.zx,{variant:"outline",onClick:n,children:"Close"})]})]})}var u=(0,s.FF)(function(){let{user:e,profile:a}=(0,s.aC)(),[l,u]=(0,n.useState)({calls:[],journals:{},isLoading:!0,pagination:{page:1,limit:25,total:0,totalPages:0}}),[x,m]=(0,n.useState)({location:"",period:"7d",agent:(null==a?void 0:a.role)==="staff"&&(null==e?void 0:e.email)||"",dateRange:{start:"",end:""}}),[h,j]=(0,n.useState)(""),[g,p]=(0,n.useState)(null),[v,_]=(0,n.useState)(!1),[b,f]=(0,n.useState)({key:"call_start_time",direction:"desc"});(0,n.useEffect)(()=>{y()},[x,l.pagination.page,b,h]);let y=async()=>{u(e=>({...e,isLoading:!0}));try{var e,a;let t=new URLSearchParams({page:l.pagination.page.toString(),limit:l.pagination.limit.toString(),sort:"".concat(b.key,":").concat(b.direction),...x.location&&{location:x.location},...x.agent&&{agent:x.agent},...h&&{search:h},...(null===(e=x.dateRange)||void 0===e?void 0:e.start)&&{start_date:x.dateRange.start},...(null===(a=x.dateRange)||void 0===a?void 0:a.end)&&{end_date:x.dateRange.end}}),[n,s]=await Promise.all([fetch("/api/call-records/simple?".concat(t)),fetch("/api/call-journals/simple?call_ids=".concat(l.calls.map(e=>e.id).join(",")))]),i=await n.json(),r=await s.json(),o={};r.data&&r.data.forEach(e=>{o[e.call_record_id]=e}),u({calls:i.data||[],journals:o,isLoading:!1,pagination:i.pagination||l.pagination})}catch(e){u(e=>({...e,isLoading:!1}))}},N=(e,a)=>{m(l=>({...l,[e]:a})),u(e=>({...e,pagination:{...e.pagination,page:1}}))},w=e=>{p(e),_(!0)},C=async()=>{try{let e={format:"csv",search:h};x.location&&(e.location=x.location),x.period&&(e.period=x.period),x.agent&&(e.agent=x.agent);let a=new URLSearchParams(e),l=await fetch("/api/call-records/export?".concat(a));if(l.ok){let e=await l.blob(),a=window.URL.createObjectURL(e),t=document.createElement("a");t.href=a,t.download="call-history-".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(a),document.body.removeChild(t)}}catch(e){}};return(0,t.jsxs)(i.LN,{children:[(0,t.jsx)(i.mr,{title:"Call History",subtitle:"View and manage call records and journals",actions:(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsx)(i.zx,{variant:"outline",onClick:C,children:"\uD83D\uDCCA Export"}),(0,t.jsx)(i.zx,{variant:"primary",onClick:()=>window.location.href="/calls/journal",children:"\uD83D\uDCDD New Journal"})]})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(i.Zb,{className:"p-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[(0,t.jsx)("div",{className:"md:col-span-2",children:(0,t.jsx)(i.II,{placeholder:"Search calls...",value:h,onChange:e=>j(e.target.value)})}),(0,t.jsx)(i.Ph,{value:x.location||"",onChange:e=>N("location",e.target.value),options:[{value:"all",label:"All Locations"},{value:"ann_arbor",label:"Ann Arbor"},{value:"wixom",label:"Wixom"},{value:"plymouth",label:"Plymouth"}],placeholder:"Location"}),((null==a?void 0:a.role)==="admin"||(null==a?void 0:a.role)==="staff")&&(0,t.jsx)(i.Ph,{value:x.agent||"",onChange:e=>N("agent",e.target.value),options:[{value:"all",label:"All Agents"}],placeholder:"Agent"}),(0,t.jsx)(i.Ph,{value:x.period||"",onChange:e=>N("period",e.target.value),options:[{value:"today",label:"Today"},{value:"7d",label:"Last 7 Days"},{value:"30d",label:"Last 30 Days"},{value:"90d",label:"Last 90 Days"}]}),(0,t.jsx)(i.zx,{variant:"outline",onClick:()=>{m({location:"",period:"7d",agent:(null==a?void 0:a.role)==="staff"&&(null==e?void 0:e.email)||"",dateRange:{start:"",end:""}}),j("")},children:"Clear Filters"})]})}),(0,t.jsx)(i.Zb,{className:"p-6",children:l.isLoading?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(i.TK,{size:"lg"})}):(0,t.jsx)(i.wQ,{data:l.calls,columns:[{key:"call_start_time",header:"Date/Time",sortable:!0,render:e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:r(e.call_start_time)}),(0,t.jsx)("div",{className:"text-sm text-neutral-500",children:o(e.call_start_time)})]})},{key:"caller_name",header:"Caller",sortable:!0,render:e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.caller_name||"Unknown"}),(0,t.jsx)("div",{className:"text-sm text-neutral-500",children:e.caller_phone})]})},{key:"call_direction",header:"Direction",render:e=>(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs ".concat("inbound"===e.call_direction?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:"inbound"===e.call_direction?"\uD83D\uDCDE Inbound":"\uD83D\uDCF1 Outbound"})},{key:"call_outcome",header:"Outcome",render:e=>{var a;return(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs ".concat("appointment_scheduled"===e.call_outcome?"bg-green-100 text-green-800":"information_provided"===e.call_outcome?"bg-blue-100 text-blue-800":"transfer_required"===e.call_outcome?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"),children:(null===(a=e.call_outcome)||void 0===a?void 0:a.replace("_"," "))||"No outcome"})}},{key:"talk_duration_seconds",header:"Duration",sortable:!0,render:e=>c(e.talk_duration_seconds||0)},{key:"quality_score",header:"Quality",sortable:!0,render:e=>e.quality_score?(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full mr-2 ".concat(e.quality_score>=90?"bg-green-500":e.quality_score>=80?"bg-blue-500":e.quality_score>=70?"bg-yellow-500":"bg-red-500")}),(0,t.jsxs)("span",{className:"font-medium",children:[e.quality_score,"%"]})]}):(0,t.jsx)("span",{className:"text-neutral-400",children:"Not scored"})},{key:"journal_status",header:"Journal",render:e=>{let a=l.journals[e.id];return a?(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs ".concat("approved"===a.journal_status?"bg-green-100 text-green-800":"reviewed"===a.journal_status?"bg-blue-100 text-blue-800":"submitted"===a.journal_status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:a.journal_status}):(0,t.jsx)(i.zx,{size:"sm",variant:"outline",onClick:()=>window.location.href="/calls/journal?call_id=".concat(e.id),children:"Create Journal"})}},{key:"actions",header:"Actions",render:e=>(0,t.jsxs)("div",{className:"flex space-x-1",children:[(0,t.jsx)(i.zx,{size:"sm",variant:"outline",onClick:()=>w(e),children:"\uD83D\uDC41ï¸"}),e.recording_available&&(0,t.jsx)(i.zx,{size:"sm",variant:"outline",onClick:()=>window.open(e.recording_url,"_blank"),children:"\uD83C\uDFB5"})]})}],onSort:e=>{f(a=>({key:e,direction:a.key===e&&"asc"===a.direction?"desc":"asc"}))},sortBy:b.key,sortDirection:b.direction})})]}),(0,t.jsx)(i.u_,{isOpen:v,onClose:()=>_(!1),title:"Call Details",size:"lg",children:g&&(0,t.jsx)(d,{call:g,journal:l.journals[g.id],onClose:()=>_(!1)})})]})},{requiredRoles:["staff","manager","superadmin"]})}},function(e){e.O(0,[946,848,888,774,179],function(){return e(e.s=7168)}),_N_E=e.O()}]);