# GitHub Actions Deployment to Vercel

## Overview

This deployment method uses GitHub Actions to build the monorepo locally and deploy the pre-built output to Vercel. This avoids the complexities of Vercel's build system with pnpm workspaces.

## How It Works

1. **GitHub Actions** builds the entire monorepo with all dependencies
2. **Vercel CLI** creates the deployment artifacts
3. **Pre-built deployment** pushes the compiled output to Vercel
4. **No build on Vercel** - just serves the pre-built files

## Setup Instructions

### 1. Commit and Push the Workflow

```bash
git add .github/workflows/deploy-vercel.yml
git commit -m "Add GitHub Actions deployment workflow"
git push origin main
```

### 2. Trigger the Deployment

You can trigger the deployment in two ways:

#### Option A: Automatic (on push to main)
```bash
# Any push to main will trigger deployment
git push origin main
```

#### Option B: Manual (workflow dispatch)
1. Go to your GitHub repository
2. Click on "Actions" tab
3. Select "Deploy to Vercel" workflow
4. Click "Run workflow" button
5. Select "main" branch
6. Click "Run workflow"

### 3. Monitor the Deployment

1. Go to GitHub Actions tab
2. Click on the running workflow
3. Watch the logs in real-time
4. The deployment URL will appear in the final step

## Workflow Steps Explained

1. **Checkout Code** - Gets the latest code from the repository
2. **Setup pnpm** - Installs pnpm package manager v9
3. **Setup Node.js** - Installs Node.js v20 with pnpm caching
4. **Install Dependencies** - Runs `pnpm install` with frozen lockfile
5. **Build Project** - Runs `pnpm build:staff` to build all packages and the staff app
6. **Install Vercel CLI** - Installs the latest Vercel CLI globally
7. **Pull Vercel Environment** - Gets project configuration from Vercel
8. **Build for Vercel** - Creates Vercel-specific build output
9. **Deploy to Vercel** - Deploys the pre-built output to production

## Environment Variables

The workflow includes:
- `VERCEL_ORG_ID` - Your Vercel team ID
- `VERCEL_PROJECT_ID` - The staff portal project ID
- `VERCEL_TOKEN` - Authentication token (currently hardcoded, should be moved to secrets)

## Security Note

⚠️ **Important**: The Vercel token is currently hardcoded in the workflow. For production use, you should:

1. Go to GitHub repository settings
2. Navigate to Secrets and variables → Actions
3. Add a new repository secret named `VERCEL_TOKEN`
4. Update the workflow to use `${{ secrets.VERCEL_TOKEN }}` instead of the hardcoded value

## Troubleshooting

### Build Fails
- Check the GitHub Actions logs for specific errors
- Ensure all dependencies are properly listed in package.json
- Verify that the build works locally with `pnpm build:staff`

### Deployment Fails
- Verify the Vercel project ID is correct
- Check that the token has proper permissions
- Ensure the `.vercel/project.json` exists in the staff app

### Wrong Deployment URL
- The deployment URL is automatically generated by Vercel
- Add a custom domain after successful deployment

## Adding Custom Domain

After successful deployment:
1. Go to Vercel dashboard
2. Select the `ganger-staff-portal` project
3. Go to Settings → Domains
4. Add `staff.gangerdermatology.com`
5. Update DNS in Cloudflare as instructed

## Benefits

- ✅ **Reliable** - Build happens in controlled GitHub Actions environment
- ✅ **Fast** - Vercel only serves pre-built files
- ✅ **Monorepo Compatible** - Handles pnpm workspaces correctly
- ✅ **Cached** - GitHub Actions caches dependencies
- ✅ **Automated** - Deploys on every push to main

## Next Steps

1. Commit and push the workflow file
2. Trigger the deployment
3. Add custom domain once deployed
4. Move Vercel token to GitHub secrets for security